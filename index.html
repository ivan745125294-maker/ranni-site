<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>å®å®æé†’ç«™ï¼ˆä¹Œè¨å¥‡&å°å…«ï¼‰</title>
  <style>
    :root{
      --bg:#f6fbff;
      --ink:#1f1f1f;
      --muted:#666;
      --card:#ffffffd9;
      --border:#00000014;
      --shadow:0 10px 26px rgba(0,0,0,.08);
      --r:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, "PingFang SC","Microsoft Yahei", Arial;
      background:
        radial-gradient(900px 520px at 15% 10%, #fff7fb, transparent 60%),
        radial-gradient(900px 520px at 90% 20%, #e9f6ff, transparent 60%),
        linear-gradient(180deg,#fff,var(--bg));
      color:var(--ink);
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:18px;
    }
    .app{
      width:min(980px, 100%);
      display:grid;
      grid-template-columns: 380px 1fr;
      gap:14px;
    }
    @media (max-width: 900px){
      .app{grid-template-columns: 1fr}
    }
    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--r);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .head{
      padding:14px 16px;
      border-bottom:1px solid var(--border);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      background:#ffffffb3;
    }
    .head .t{
      font-weight:900;
      letter-spacing:.2px;
    }
    .pill{
      font-size:12px;
      color:var(--muted);
      padding:7px 10px;
      border:1px solid var(--border);
      border-radius:999px;
      background:#fff;
      user-select:none;
    }

    /* å·¦ä¾§ï¼šäººç‰©/å½©è›‹ */
    .left{padding:14px 14px 16px}
    .title{
      margin:6px 0 8px;
      font-size:22px;
      font-weight:900;
    }
    .desc{
      margin:0 0 12px;
      color:var(--muted);
      line-height:1.7;
      font-size:14px;
    }
    .sticker{
      width:100%;
      aspect-ratio: 1 / 1;
      border-radius:22px;
      border:1px solid var(--border);
      background: radial-gradient(240px 240px at 28% 20%, #fff, #f2fbff);
      box-shadow: 0 12px 28px rgba(0,0,0,.08);
      position:relative;
      overflow:hidden;
    }
    .bubble{
      position:absolute; top:14px; left:14px;
      background:#fff;
      border:1px solid var(--border);
      border-radius:16px;
      padding:10px 12px;
      font-weight:800;
      box-shadow: 0 8px 18px rgba(0,0,0,.07);
      white-space:pre-line;
    }
    .chars{
      position:absolute; inset:0;
      display:flex;
      align-items:flex-end;
      justify-content:space-around;
      padding:26px 18px 16px;
      gap:14px;
    }
    .c{
      width:45%;
      height:58%;
      border-radius:22px;
      border:1px solid var(--border);
      background:#fff;
      display:flex;
      align-items:center;
      justify-content:center;
      position:relative;
    }
    .face{
      width:74%;
      height:74%;
      border-radius:20px;
      border:1px solid var(--border);
      position:relative;
      background: linear-gradient(180deg,#fff, #fafafa);
    }
    .ear{
      position:absolute; width:34%; height:30%;
      border:1px solid var(--border);
      border-radius:14px; top:-10%; background:#fff;
    }
    .ear.l{left:6%} .ear.r{right:6%}
    .eye{position:absolute; top:42%; width:10px; height:14px; background:#222; border-radius:10px;}
    .eye.l{left:28%} .eye.r{right:28%}
    .mouth{
      position:absolute; top:62%; left:50%;
      width:22px; height:10px;
      border:2px solid #222;
      border-top:none; border-left:none; border-right:none;
      transform:translateX(-50%);
      border-radius:0 0 999px 999px;
    }
    .tag{
      position:absolute; bottom:10px; left:50%;
      transform:translateX(-50%);
      font-size:12px; color:var(--muted);
      background:#ffffffd9; border:1px solid var(--border);
      border-radius:999px; padding:6px 10px;
    }
    .spark{position:absolute; right:14px; bottom:14px; display:flex; gap:6px; opacity:.9;}
    .dot{width:10px;height:10px;border-radius:50%;border:1px solid var(--border);background:#fff; animation: float 2.2s ease-in-out infinite;}
    .dot:nth-child(2){animation-delay:.25s} .dot:nth-child(3){animation-delay:.5s}
    @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}
    .shake{animation: shake .28s ease-in-out 1}
    @keyframes shake{0%{transform:translateX(0)}25%{transform:translateX(-6px)}50%{transform:translateX(6px)}75%{transform:translateX(-4px)}100%{transform:translateX(0)}}

    .panel{
      margin-top:12px;
      padding:12px;
      border-radius:14px;
      border:1px dashed var(--border);
      background:#ffffffb3;
    }
    .row{display:flex; gap:10px; flex-wrap:wrap}
    button{
      border:1px solid var(--border);
      background:#fff;
      border-radius:14px;
      padding:12px 14px;
      font-size:14px;
      cursor:pointer;
      transition: transform .08s ease, box-shadow .2s ease;
      box-shadow: 0 6px 16px rgba(0,0,0,.06);
    }
    button:hover{box-shadow:0 10px 24px rgba(0,0,0,.10)}
    button:active{transform:translateY(1px) scale(.99)}
    .primary{background:linear-gradient(180deg,#fff,#f1fbff); border-color:#00000012;}
    .mini{
      margin-top:10px;
      display:flex; gap:10px; flex-wrap:wrap;
      font-size:12px; color:var(--muted);
    }
    .kpi{
      padding:7px 10px;
      border:1px solid var(--border);
      border-radius:999px;
      background:#fff;
    }

    /* å³ä¾§ï¼šèŠå¤©åŒº */
    .chat{
      display:flex;
      flex-direction:column;
      height: min(720px, 80vh);
    }
    .chatbox{
      padding:14px;
      overflow:auto;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .line{
      display:flex;
      gap:8px;
      align-items:flex-end;
    }
    .line.me{justify-content:flex-end}
    .avatar{
      width:34px;height:34px;border-radius:999px;
      border:1px solid var(--border);
      background:#fff;
      display:flex;align-items:center;justify-content:center;
      font-size:16px;
      flex:0 0 auto;
    }
    .bubble2{
      max-width:min(520px, 78%);
      padding:10px 12px;
      border-radius:16px;
      border:1px solid var(--border);
      background:#fff;
      line-height:1.6;
      box-shadow: 0 6px 16px rgba(0,0,0,.06);
      white-space:pre-line;
    }
    .me .bubble2{
      background: linear-gradient(180deg,#fff,#f7fffa);
    }
    .meta{
      font-size:11px;
      color:var(--muted);
      margin: 2px 8px 0;
    }
    .composer{
      border-top:1px solid var(--border);
      padding:12px 14px;
      display:flex;
      gap:10px;
      align-items:center;
      background:#ffffffb3;
      flex-wrap:wrap;
    }
    .composer .hint{color:var(--muted); font-size:12px}
    .btns{display:flex; gap:10px; flex-wrap:wrap}
    .foot{
      padding:12px 14px;
      border-top:1px solid var(--border);
      color:var(--muted);
      font-size:12px;
      background:#ffffffb3;
    }
    a{color:inherit}
  </style>
</head>
<body>
  <div class="app">
    <div class="card">
      <div class="head">
        <div class="t">ğŸ’— å®å®æé†’ç«™</div>
        <div class="pill" id="today"></div>
      </div>
      <div class="left">
        <div class="title">ä¹Œè¨å¥‡&å°å…«ï¼šä»Šæ—¥å·¡é€»</div>
        <p class="desc">
          è¿™ä¸ªé¡µé¢åªåšä¸‰ä»¶äº‹ï¼š<b>å«ä½ èµ·åºŠ</b>ã€<b>æé†’ä½ åƒé¥­</b>ã€<b>è®©ä½ è®°å¾—æƒ³æˆ‘</b>ã€‚
          ä½ ç‚¹ä¸€ä¸‹ï¼Œå³è¾¹å°±ä¼šåƒèŠå¤©ä¸€æ ·å¼¹å‡ºæ¶ˆæ¯ï¼›å¥¹ä¹Ÿå¯ä»¥ç‚¹â€œæˆ‘èµ·åºŠäº†/æˆ‘åƒé¥­äº†/æˆ‘ä¹Ÿæƒ³ä½ â€æ¥å›ä½ ã€‚
        </p>

        <div class="sticker" id="sticker">
          <div class="bubble" id="stickerBubble">å®å®ï½èµ·åºŠäº†å—ï¼Ÿ\nï¼ˆå°å…«ä¸¾æ‰‹ï¼šæˆ‘æ¥é—®ï¼ï¼‰</div>
          <div class="chars">
            <div class="c">
              <div class="face">
                <div class="ear l"></div><div class="ear r"></div>
                <div class="eye l"></div><div class="eye r"></div>
                <div class="mouth"></div>
              </div>
              <div class="tag">å°å…«</div>
            </div>
            <div class="c" style="background:#fff7ef">
              <div class="face" style="background:linear-gradient(180deg,#fff7ef,#fff)">
                <div class="ear l" style="background:#fff7ef"></div>
                <div class="ear r" style="background:#fff7ef"></div>
                <div class="eye l"></div><div class="eye r"></div>
                <div class="mouth"></div>
              </div>
              <div class="tag">ä¹Œè¨å¥‡</div>
            </div>
          </div>
          <div class="spark" aria-hidden="true">
            <div class="dot"></div><div class="dot"></div><div class="dot"></div>
          </div>
        </div>

        <div class="panel">
          <div class="row">
            <button class="primary" id="wake">ğŸ›ï¸ èµ·åºŠäº†å—</button>
            <button id="eat">ğŸš è®°å¾—åƒé¥­</button>
            <button id="miss">ğŸ’­ è®°å¾—æƒ³æˆ‘</button>
            <button id="combo">âœ¨ ä¸€é”®å…¨å¥—</button>
            <button id="clear">ğŸ§¼ æ¸…ç©ºèŠå¤©</button>
          </div>
          <div class="mini">
            <div class="kpi">ä»Šå¤©ã€Œæƒ³æˆ‘ã€æ¬¡æ•°ï¼š<b id="kMiss">0</b></div>
            <div class="kpi">å¥¹çš„å›æ‰§ï¼š<b id="kAck">æš‚æ— </b></div>
          </div>
        </div>
      </div>
    </div>

    <div class="card chat">
      <div class="head">
        <div class="t">ğŸ’¬ ä½ ä»¬çš„èŠå¤©</div>
        <div class="pill">ç‚¹æŒ‰é’®å°±ä¼šå‘æ¶ˆæ¯</div>
      </div>

      <div class="chatbox" id="chatbox"></div>

      <div class="composer">
        <div class="hint">å¥¹å¯ä»¥ç‚¹è¿™äº›å›ä½ ï¼š</div>
        <div class="btns">
          <button id="ackWake">âœ… æˆ‘èµ·åºŠå•¦</button>
          <button id="ackEat">âœ… æˆ‘åƒé¥­å•¦</button>
          <button id="ackMiss">ğŸ’— æˆ‘ä¹Ÿæƒ³ä½ </button>
        </div>
      </div>

      <div class="foot">
        å°æŠ€å·§ï¼šæŠŠæ–‡æ¡ˆé‡Œçš„â€œå®å®/æƒ³æˆ‘â€æ”¹æˆä½ ä»¬çš„ä¸“å±ç§°å‘¼å’Œæš—å·ï¼Œæ€ä¼¤åŠ›ä¼šæ›´å¼ºã€‚
      </div>
    </div>
  </div>

  <script>
    const $ = (s)=>document.querySelector(s);
    const chatbox = $("#chatbox");
    const sticker = $("#sticker");
    const stickerBubble = $("#stickerBubble");

    const LS = {
      miss: "baby2_miss_count",
      ack:  "baby2_ack",
      chat: "baby2_chat",
    };

    function todayStr(){
      const d = new Date();
      const y = d.getFullYear();
      const m = String(d.getMonth()+1).padStart(2,"0");
      const day = String(d.getDate()).padStart(2,"0");
      return `${y}-${m}-${day}`;
    }
    $("#today").textContent = `ğŸ“… ${todayStr()}`;

    function hm(){
      const d = new Date();
      return String(d.getHours()).padStart(2,"0")+":"+String(d.getMinutes()).padStart(2,"0");
    }

    function shake(){
      sticker.classList.remove("shake");
      void sticker.offsetWidth;
      sticker.classList.add("shake");
    }

    function readInt(k, def=0){
      const v = Number(localStorage.getItem(k));
      return Number.isFinite(v) ? v : def;
    }
    function write(k, v){ localStorage.setItem(k, String(v)); }

    function setKPI(){
      $("#kMiss").textContent = readInt(LS.miss, 0);
      $("#kAck").textContent = localStorage.getItem(LS.ack) || "æš‚æ— ";
    }

    function pushLine(who, avatar, text){
      const t = hm();
      const line = document.createElement("div");
      line.className = "line " + (who==="me" ? "me" : "them");

      if(who!=="me"){
        const av = document.createElement("div");
        av.className = "avatar";
        av.textContent = avatar;
        line.appendChild(av);
      }

      const bub = document.createElement("div");
      bub.className = "bubble2";
      bub.textContent = text;
      line.appendChild(bub);

      if(who==="me"){
        const av = document.createElement("div");
        av.className = "avatar";
        av.textContent = avatar;
        line.appendChild(av);
      }

      const meta = document.createElement("div");
      meta.className = "meta";
      meta.textContent = t;

      const wrapper = document.createElement("div");
      wrapper.appendChild(line);
      wrapper.appendChild(meta);

      chatbox.appendChild(wrapper);
      chatbox.scrollTop = chatbox.scrollHeight;

      saveChat();
    }

    function saveChat(){
      // ä¿å­˜çº¯æ–‡æœ¬ç‰ˆèŠå¤©ï¼ˆç®€å•å¤Ÿç”¨ï¼‰
      const items = [];
      chatbox.querySelectorAll(".bubble2").forEach(b => items.push(b.textContent));
      localStorage.setItem(LS.chat, JSON.stringify(items));
    }

    function loadChat(){
      const raw = localStorage.getItem(LS.chat);
      if(!raw) return;
      try{
        const arr = JSON.parse(raw);
        if(!Array.isArray(arr)) return;
        // ç®€åŒ–ï¼šé‡æ–°ç”Ÿæˆæˆâ€œç³»ç»Ÿè®°å½•â€ï¼ˆä¸åŒºåˆ†å·¦å³ï¼‰
        chatbox.innerHTML = "";
        arr.forEach(txt=>{
          pushLine("them","ğŸ’¬", txt);
        });
      }catch(e){}
    }

    function stickerSay(text){
      stickerBubble.textContent = text;
      shake();
    }

    function send(type){
      if(type==="wake"){
        pushLine("them","ğŸ°", "å®å®ï½èµ·åºŠäº†å—ï¼Ÿ\né†’äº†å°±å…ˆå–ä¸¤å£æ°´ï¼Œå†æ…¢æ…¢æ¥ã€‚");
        stickerSay("èµ·åºŠäº†å—ï¼Ÿ\nï¼ˆä¹Œè¨å¥‡ï¼šå¿«å¿«å¿«ï¼ï¼‰");
      }
      if(type==="eat"){
        pushLine("them","ğŸª½", "è®°å¾—åƒé¥­ï¼\nå“ªæ€•å¿™ï¼Œä¹Ÿè¦å…ˆå«ç‚¹ä¸œè¥¿ï½");
        stickerSay("è®°å¾—åƒé¥­ï¼\nï¼ˆå°å…«ï¼šæˆ‘ç›¯ç€ä½ ï¼‰");
      }
      if(type==="miss"){
        const c = readInt(LS.miss,0)+1;
        write(LS.miss, c);
        pushLine("them","ğŸ’—", `è¿˜æœ‰ä¸€ä»¶äº‹ï¼šè®°å¾—æƒ³æˆ‘ã€‚\nï¼ˆä»Šå¤©å·²æƒ³æˆ‘ ${c} æ¬¡ï¼‰`);
        stickerSay("è®°å¾—æƒ³æˆ‘ï¼\nï¼ˆä¸¤åªä¸€èµ·ç‚¹å¤´ï¼‰");
      }
      if(type==="combo"){
        send("wake"); send("eat"); send("miss");
      }
      setKPI();
    }

    function ack(type){
      let text="";
      if(type==="wake"){ text="æˆ‘èµ·åºŠå•¦ï¼ä½ åˆ«å‡¶æˆ‘ï½"; }
      if(type==="eat"){ text="æˆ‘åƒé¥­å•¦ï¼ä½ ä¹Ÿè¦è®°å¾—åƒã€‚"; }
      if(type==="miss"){ text="æˆ‘ä¹Ÿæƒ³ä½ ã€‚"; }
      pushLine("me","ğŸ˜Š", text);
      write(LS.ack, text);
      setKPI();
      stickerSay("æ”¶åˆ°å›æ‰§ï¼\nï¼ˆä¹Œè¨å¥‡ï¼šæ»¡æ„ï¼‰");
    }

    $("#wake").addEventListener("click", ()=>send("wake"));
    $("#eat").addEventListener("click", ()=>send("eat"));
    $("#miss").addEventListener("click", ()=>send("miss"));
    $("#combo").addEventListener("click", ()=>send("combo"));

    $("#ackWake").addEventListener("click", ()=>ack("wake"));
    $("#ackEat").addEventListener("click", ()=>ack("eat"));
    $("#ackMiss").addEventListener("click", ()=>ack("miss"));

    $("#clear").addEventListener("click", ()=>{
      chatbox.innerHTML="";
      localStorage.removeItem(LS.chat);
      stickerSay("æ¸…ç©ºå•¦ï½\nï¼ˆå°å…«ï¼šé‡æ–°å¼€å§‹ï¼‰");
    });

    // åˆæ¬¡æ¬¢è¿è¯­
    setKPI();
    if(!localStorage.getItem(LS.chat)){
      pushLine("them","ğŸ°", "å®å®æé†’ç«™å·²ä¸Šçº¿ã€‚\nå…ˆé—®ä¸€å¥ï¼šèµ·åºŠäº†å—ï¼Ÿ");
      stickerSay("å®å®ï½èµ·åºŠäº†å—ï¼Ÿ\nï¼ˆå°å…«ä¸¾æ‰‹ï¼šæˆ‘æ¥é—®ï¼ï¼‰");
    }else{
      // ä½ ä¸æƒ³è‡ªåŠ¨æ¢å¤èŠå¤©ï¼Œåˆ æ‰è¿™è¡Œ
      // loadChat();
    }
  </script>
</body>
</html>
