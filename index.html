<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ranniå®å®èµ·åºŠå•¦</title>
  <style>
    :root{
      --bg1:#fff7fb;
      --bg2:#eaf7ff;
      --ink:#222;
      --muted:#666;
      --card:#ffffffd6;
      --border:#00000014;
      --shadow:0 12px 30px rgba(0,0,0,.10);
      --r:20px;
      --accent:#ff5aa5;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, "PingFang SC","Microsoft Yahei", Arial;
      color:var(--ink);
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:18px;
      background:
        radial-gradient(900px 520px at 15% 10%, var(--bg1), transparent 60%),
        radial-gradient(900px 520px at 90% 20%, var(--bg2), transparent 60%),
        linear-gradient(180deg,#fff,#f7fbff);
    }
    .wrap{width:min(980px, 100%)}
    .top{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      margin-bottom:12px;
      flex-wrap:wrap;
    }
    .pill{
      padding:8px 12px;
      border:1px solid var(--border);
      background:#fff;
      border-radius:999px;
      font-size:13px;
      color:var(--muted);
      box-shadow: 0 6px 16px rgba(0,0,0,.06);
      user-select:none;
    }
    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--r);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .main{
      display:grid;
      grid-template-columns: 380px 1fr;
      gap:14px;
      padding:14px;
    }
    @media (max-width: 900px){ .main{grid-template-columns:1fr} }

    /* å·¦ä¾§ï¼šè´´çº¸åŒºï¼ˆç¨³å®šç‰ˆï¼šä¸ä¼šå› ä¸ºå¤ªå¤§è€Œâ€œç‚¸â€ï¼‰ */
    .sticker{
      width:100%;
      aspect-ratio: 1 / 1;
      border-radius:22px;
      border:1px solid var(--border);
      background: radial-gradient(240px 240px at 28% 20%, #fff, #f2fbff);
      box-shadow: 0 12px 28px rgba(0,0,0,.08);
      position:relative;
      overflow:hidden;
    }
    .st-bubble{
      position:absolute; top:14px; left:14px;
      background:#fff;
      border:1px solid var(--border);
      border-radius:16px;
      padding:10px 12px;
      font-weight:900;
      box-shadow: 0 8px 18px rgba(0,0,0,.07);
      white-space:pre-line;
      max-width:80%;
      z-index:2;
    }
    .chars{
      position:absolute; inset:0;
      display:flex;
      align-items:flex-end;
      justify-content:space-around;
      padding:64px 16px 16px; /* ç¡®ä¿ä¸ä¼šé¡¶åˆ°æ°”æ³¡ */
      gap:12px;
      z-index:1;
    }
    .c{
      width:48%;
      height:78%;
      border-radius:22px;
      border:1px solid var(--border);
      background:#fff;
      display:flex;
      align-items:center;
      justify-content:center;
      position:relative;
      overflow:hidden; /* é˜²æ­¢å›¾ç‰‡æ’‘çˆ† */
    }
    .stImg{
      width:100%;
      height:100%;
      object-fit:contain;
      /* å…ˆä¸ç¼©æ”¾ï¼Œç¡®ä¿â€œå¿…æ˜¾ç¤ºâ€ã€‚ä½ æƒ³æ›´å¤§å†åŠ  scale */
      transform:none;
      pointer-events:none;
    }
    /* å¦‚æœä½ ç¡®è®¤èƒ½æ˜¾ç¤ºäº†ï¼Œå†æŠŠä¸‹é¢è¿™è¡Œè§£é™¤æ³¨é‡Šæ¥æ”¾å¤§ä¸€ç‚¹ï¼š
    .stImg{ transform: scale(1.18); transform-origin:center bottom; }
    */

    .tag{
      position:absolute; bottom:10px; left:50%;
      transform:translateX(-50%);
      font-size:12px; color:var(--muted);
      background:#ffffffd9; border:1px solid var(--border);
      border-radius:999px; padding:6px 10px;
      z-index:3;
    }
    .shake{animation: shake .28s ease-in-out 1}
    @keyframes shake{
      0%{transform:translateX(0)}
      25%{transform:translateX(-6px)}
      50%{transform:translateX(6px)}
      75%{transform:translateX(-4px)}
      100%{transform:translateX(0)}
    }

    /* å³ä¾§ï¼šæµç¨‹å¯¹è¯ */
    .panel{
      border-radius:18px;
      border:1px solid var(--border);
      background:#ffffffb3;
      padding:14px;
      min-height:380px;
      position:relative;
      overflow:hidden;
    }
    .title{
      margin:0 0 6px;
      font-size:22px;
      font-weight:950;
      letter-spacing:.2px;
    }
    .sub{
      margin:0 0 14px;
      color:var(--muted);
      line-height:1.6;
      font-size:14px;
    }
    .dialog{
      border:1px solid var(--border);
      background:#fff;
      border-radius:16px;
      padding:12px 12px;
      line-height:1.7;
      box-shadow: 0 6px 16px rgba(0,0,0,.06);
      white-space:pre-line;
    }
    .options{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:12px;
    }
    button{
      border:1px solid var(--border);
      background:#fff;
      border-radius:14px;
      padding:12px 14px;
      font-size:14px;
      cursor:pointer;
      box-shadow: 0 6px 16px rgba(0,0,0,.06);
      transition: transform .08s ease, box-shadow .2s ease;
    }
    button:hover{box-shadow:0 10px 24px rgba(0,0,0,.10)}
    button:active{transform:translateY(1px) scale(.99)}
    .primary{
      background: linear-gradient(180deg,#fff,#f1fbff);
      border-color:#00000010;
    }
    .danger{
      border-color:#ff000022;
      background: linear-gradient(180deg,#fff,#fff3f6);
    }
    .tiny-corner{
      position:absolute;
      right:12px;
      bottom:12px;
      font-size:12px;
      padding:8px 10px;
      border-radius:999px;
      opacity:.85;
    }

    .flash{
      position:absolute;
      inset:auto 0 56px 0;
      text-align:center;
      font-weight:950;
      letter-spacing:.5px;
      color:var(--accent);
      text-shadow: 0 6px 22px rgba(255,90,165,.35);
      animation: pop 0.35s ease-out 1, blink 1.1s ease-in-out infinite;
      pointer-events:none;
      padding:0 12px;
    }
    @keyframes pop{ from{transform:translateY(6px); opacity:0} to{transform:translateY(0); opacity:1} }
    @keyframes blink{ 0%,100%{opacity:.2} 50%{opacity:1} }

    .audioBox{
      margin-top:12px;
      border:1px dashed var(--border);
      border-radius:14px;
      padding:12px;
      background:#ffffffcc;
      color:var(--muted);
      font-size:13px;
      line-height:1.6;
    }
    audio{width:100%; margin-top:8px;}

    .footer{
      padding:12px 14px;
      border-top:1px solid var(--border);
      background:#ffffffb3;
      color:var(--muted);
      font-size:12px;
      display:flex;
      gap:10px;
      justify-content:space-between;
      flex-wrap:wrap;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div class="pill">ğŸ’— Ranniå®å®</div>
      <div class="pill" id="today"></div>
      <div class="pill">ä¹Œè¨å¥‡ & å°å…«ï¼šåœ¨ç›¯ä½ </div>
    </div>

    <div class="card">
      <div class="main">
        <div>
          <div class="sticker" id="sticker">
            <div class="st-bubble" id="stBubble">Ranniå®å®ï½èµ·åºŠäº†å—ï¼Ÿ\nï¼ˆå°å…«ï¼šæˆ‘æ¥é—®ï¼ï¼‰</div>

            <div class="chars">
              <div class="c">
                <!-- âœ… æ³¨æ„ï¼šæ–‡ä»¶å¿…é¡»åœ¨ä»“åº“ assets/ é‡Œï¼Œä¸”å¤§å°å†™ä¸€è‡´ -->
                <img class="stImg" src="assets/hachi.webp?v=2" alt="å°å…«" loading="lazy">
                <div class="tag">å°å…«</div>
              </div>

              <div class="c" style="background:#fff7ef">
                <img class="stImg" src="assets/usagi.webp?v=2" alt="ä¹Œè¨å¥‡" loading="lazy">
                <div class="tag">ä¹Œè¨å¥‡</div>
              </div>
            </div>
          </div>
        </div>

        <div class="panel" id="panel">
          <h1 class="title" id="title">Ranniå®å®æ—©å®‰</h1>
          <p class="sub" id="sub">å…ˆå›ç­”ä¸€ä¸‹ï½</p>

          <div class="dialog" id="dialog"></div>
          <div class="options" id="options"></div>

          <div id="corner"></div>
          <div id="flashHost"></div>
        </div>
      </div>

      <div class="footer">
        <div>ğŸŒ™ è®°å¾—ç…§é¡¾è‡ªå·±ï¼Œä¹Ÿè®°å¾—æƒ³æˆ‘ã€‚</div>
        <div>â€” æº</div>
      </div>
    </div>
  </div>

<script>
  // å¯é€‰ï¼šWebhookï¼ˆä¸ç”¨å°±ç•™ç©ºï¼‰
  const NOTIFY_URL = "";
  // èµ–åºŠéŸ³é¢‘ï¼ˆä¸ç”¨å°±ç•™ç©ºï¼‰
  const SWIM_AUDIO_URL = "";
  // å¤åˆ¶æ¶ˆæ¯ + å°è¯•æ‰“å¼€å¾®ä¿¡
  const SOURCE_NAME = "æº";
  const WECHAT_OPEN_SCHEME = "weixin://";

  const $ = (s)=>document.querySelector(s);
  const sticker = $("#sticker");
  const stBubble = $("#stBubble");
  const titleEl = $("#title");
  const subEl = $("#sub");
  const dialogEl = $("#dialog");
  const optionsEl = $("#options");
  const cornerEl = $("#corner");
  const flashHost = $("#flashHost");

  function todayStr(){
    const d = new Date();
    const y = d.getFullYear();
    const m = String(d.getMonth()+1).padStart(2,"0");
    const day = String(d.getDate()).padStart(2,"0");
    return `${y}-${m}-${day}`;
  }
  $("#today").textContent = `ğŸ“… ${todayStr()}`;

  function hm(){
    const d = new Date();
    return String(d.getHours()).padStart(2,"0")+":"+String(d.getMinutes()).padStart(2,"0");
  }
  function shake(){
    sticker.classList.remove("shake");
    void sticker.offsetWidth;
    sticker.classList.add("shake");
  }
  function setSticker(text){
    stBubble.textContent = text;
    shake();
  }
  function flash(text){
    flashHost.innerHTML = "";
    const d = document.createElement("div");
    d.className = "flash";
    d.textContent = text;
    flashHost.appendChild(d);
    setTimeout(()=>{ flashHost.innerHTML=""; }, 2000);
  }
  function clearUI(){
    optionsEl.innerHTML = "";
    cornerEl.innerHTML = "";
  }
  async function copyToClipboard(text){
    try{
      await navigator.clipboard.writeText(text);
      return true;
    }catch(e){
      const ta = document.createElement("textarea");
      ta.value = text;
      document.body.appendChild(ta);
      ta.select();
      try{ document.execCommand("copy"); }catch(_){}
      document.body.removeChild(ta);
      return true;
    }
  }

  async function notifySource(level){
    const payload = {
      type: "miss_you",
      level,
      time: new Date().toISOString(),
      local_time: hm(),
      from: "Ranni site"
    };

    if(NOTIFY_URL){
      try{
        await fetch(NOTIFY_URL, {
          method: "POST",
          headers: {"Content-Type":"application/json"},
          body: JSON.stringify(payload)
        });
      }catch(e){}
    }

    const msg = `Ranniï¼šæˆ‘${level}ä½ äº†ğŸ’—ï¼ˆ${hm()}ï¼‰`;
    await copyToClipboard(msg);

    try{ window.location.href = WECHAT_OPEN_SCHEME; }catch(e){}

    dialogEl.textContent =
`æˆ‘æ”¶åˆ°äº†ï½ğŸ’—
ç°åœ¨å›å¾®ä¿¡ç»™${SOURCE_NAME}å‘ä¸€å¥å°±å¥½ï¼š
ã€Œ${msg}ã€`;

    setSticker("æ”¶åˆ°ï½\nï¼ˆä¹Œè¨å¥‡ï¼šå“¼å“¼ï¼‰");
    flash("ğŸ’— å·²æ”¶åˆ°æƒ³ä½ ");
    clearUI();
    optionsEl.appendChild(btn("å†è¯´ä¸€æ¬¡ï¼ˆæ›´æƒ³ï¼‰", ()=>go("miss"), "primary"));
    optionsEl.appendChild(btn("å›åˆ°å¼€å¤´", ()=>go("start")));
  }

  function btn(text, onClick, cls=""){
    const b = document.createElement("button");
    b.textContent = text;
    b.className = cls;
    b.addEventListener("click", onClick);
    return b;
  }

  let state = "start";
  let dontWantClicks = 0;

  function render(){
    clearUI();

    if(state === "start"){
      titleEl.textContent = "Ranniå®å®æ—©å®‰";
      subEl.textContent = "å…ˆå›ç­”ä¸€ä¸‹ï½";
      dialogEl.textContent = "Ranniå®å®ï½èµ·åºŠäº†å—ï¼Ÿ";
      setSticker("Ranniå®å®ï½èµ·åºŠäº†å—ï¼Ÿ\nï¼ˆå°å…«ï¼šæˆ‘æ¥é—®ï¼ï¼‰");

      optionsEl.appendChild(btn("èµ·åºŠäº†ï¼Œæº", ()=>go("awake"), "primary"));
      optionsEl.appendChild(btn("å†èµ–ä¸€ä¼šåºŠ~", ()=>go("sleep_in")));
      return;
    }

    if(state === "awake"){
      titleEl.textContent = "èµ·åºŠæˆåŠŸï¼";
      subEl.textContent = "é‚£è¦ä¹–ä¹–åƒç‚¹ä¸œè¥¿ï½";
      dialogEl.textContent = "å¥½è€¶ï¼é‚£ä½ è¦è®°å¾—åƒé¥­å‘€ï½";
      setSticker("èµ·åºŠæˆåŠŸï¼\nï¼ˆä¹Œè¨å¥‡ï¼šä¸‹ä¸€æ­¥åƒé¥­ï¼ï¼‰");

      optionsEl.appendChild(btn("å¥½å“¦", ()=>go("miss"), "primary"));
      optionsEl.appendChild(btn("Ranniä¸é¥¿æ", ()=>go("not_hungry")));
      return;
    }

    if(state === "not_hungry"){
      titleEl.textContent = "ä¸é¥¿ä¹Ÿè¦ä¹–";
      subEl.textContent = "å«ä¸€ç‚¹ç‚¹å°±è¡Œï½";
      dialogEl.textContent =
"é‚£å°±å…ˆå«ä¸€ç‚¹ç‚¹ï½\nå–æ°´ä¹Ÿç®—ï¼\n\nç„¶åâ€¦è¦ä¸è¦æƒ³æºå‘€ï¼Ÿ";
      setSticker("ä¸é¥¿ä¹Ÿè¦ä¹–ã€‚\nï¼ˆå°å…«ï¼šä¸¤å£ä¹Ÿè¡Œï¼‰");

      optionsEl.appendChild(btn("ç»§ç»­", ()=>go("miss"), "primary"));
      return;
    }

    if(state === "miss"){
      titleEl.textContent = "æœ€åä¸€é¢˜";
      subEl.textContent = "è®¤çœŸç­”ï¼Œä¸è®¸éª—æˆ‘ã€‚";
      dialogEl.textContent = "é‚£â€¦Ranniå®å®æœ‰æ²¡æœ‰æƒ³æºå‘€ï¼Ÿ";
      setSticker("æƒ³æºæµ‹è¯•å¼€å§‹ï¼\nï¼ˆä¹Œè¨å¥‡&å°å…«ï¼šç›¯â€”â€”ï¼‰");

      optionsEl.appendChild(btn("æƒ³", ()=>notifySource("æƒ³"), "primary"));
      optionsEl.appendChild(btn("ç‰¹åˆ«æƒ³", ()=>notifySource("ç‰¹åˆ«æƒ³"), "primary"));

      const tiny = btn("ä¸€ç‚¹éƒ½ä¸æƒ³", ()=>handleDontWant(), "tiny-corner danger");
      cornerEl.appendChild(tiny);
      return;
    }

    if(state === "sleep_in"){
      titleEl.textContent = "èµ–åºŠè®¸å¯";
      subEl.textContent = "é‚£æˆ‘ä»¬æ¸¸ä¸€ä¼šå„¿ï½";
      dialogEl.textContent = "é‚£æˆ‘ä»¬æ¸¸ä¸€ä¼šå„¿~ è®°å¾—ä¸€ä¼šå›æ¥å“¦ã€‚";
      setSticker("èµ–åºŠè®¸å¯é€šè¿‡ã€‚\nï¼ˆå°å…«ï¼šæ¸¸ä¸€ä¼šå„¿ï¼ï¼‰");

      const box = document.createElement("div");
      box.className = "audioBox";

      if(SWIM_AUDIO_URL){
        box.innerHTML = `<b>é‚£æˆ‘ä»¬æ¸¸ä¸€ä¼šå„¿ï½</b><br/>ç‚¹æ’­æ”¾å°±å¼€å§‹æ¸¸ã€‚`;
        const audio = document.createElement("audio");
        audio.controls = true;
        audio.preload = "none";
        audio.src = SWIM_AUDIO_URL;
        box.appendChild(audio);
      }else{
        box.innerHTML = `<b>é‚£æˆ‘ä»¬æ¸¸ä¸€ä¼šå„¿ï½</b><br/>ï¼ˆå…ˆä¸æ”¾æ­Œä¹Ÿå¯ä»¥ï½ä½ èµ–ä¸€ä¼šå„¿ä¹Ÿè¡Œã€‚ï¼‰`;
      }

      optionsEl.appendChild(box);
      optionsEl.appendChild(btn("æˆ‘å›æ¥å•¦ï¼ˆç»§ç»­ï¼‰", ()=>go("start"), "primary"));
      return;
    }
  }

  function handleDontWant(){
    dontWantClicks += 1;
    if(dontWantClicks === 1){
      flash("çœŸï½çš„ä¸æƒ³ï¼Ÿ");
      setSticker("å—¯ï¼Ÿ\nï¼ˆä¹Œè¨å¥‡ï¼šä½ å†è¯´ä¸€æ¬¡ï¼Ÿï¼‰");
    }else if(dontWantClicks === 2){
      flash("ä¸è¡Œï¼è¿™å¥ä¸è®¸é€‰");
      setSticker("ä¸å¯ä»¥ï¼\nï¼ˆå°å…«ï¼šæ‘‡å¤´ï¼‰");
    }else{
      flash("æŒ‰é’®æ²¡æ”¶ğŸ˜¤ å¿…é¡»æƒ³");
      setSticker("å¿…é¡»æƒ³ï¼ï¼\nï¼ˆä¹Œè¨å¥‡ï¼šå°å°æŒ‰é’®ï¼‰");
      state = "forced_miss";
      renderForcedMiss();
    }
  }

  function renderForcedMiss(){
    clearUI();
    titleEl.textContent = "ä¸è®¸";
    subEl.textContent = "è§’è½æŒ‰é’®å·²è¢«æ²¡æ”¶ã€‚";
    dialogEl.textContent = "å¿…é¡»æƒ³ï¼ç°åœ¨é€‰ä¸€ä¸ªï¼š";
    optionsEl.appendChild(btn("æƒ³", ()=>notifySource("æƒ³"), "primary"));
    optionsEl.appendChild(btn("ç‰¹åˆ«æƒ³", ()=>notifySource("ç‰¹åˆ«æƒ³"), "primary"));
  }

  function go(next){
    state = next;
    render();
  }

  render();
</script>
</body>
</html>


