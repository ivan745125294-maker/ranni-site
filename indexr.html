<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ranniå®å®èµ·åºŠæµç¨‹ç«™</title>
  <style>
    :root{
      --bg1:#fff7fb;
      --bg2:#eaf7ff;
      --ink:#222;
      --muted:#666;
      --card:#ffffffd6;
      --border:#00000014;
      --shadow:0 12px 30px rgba(0,0,0,.10);
      --r:20px;
      --accent:#ff5aa5;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, "PingFang SC","Microsoft Yahei", Arial;
      color:var(--ink);
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:18px;
      background:
        radial-gradient(900px 520px at 15% 10%, var(--bg1), transparent 60%),
        radial-gradient(900px 520px at 90% 20%, var(--bg2), transparent 60%),
        linear-gradient(180deg,#fff,#f7fbff);
    }
    .wrap{width:min(980px, 100%)}
    .top{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      margin-bottom:12px;
      flex-wrap:wrap;
    }
    .pill{
      padding:8px 12px;
      border:1px solid var(--border);
      background:#fff;
      border-radius:999px;
      font-size:13px;
      color:var(--muted);
      box-shadow: 0 6px 16px rgba(0,0,0,.06);
      user-select:none;
    }
    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--r);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .main{
      display:grid;
      grid-template-columns: 380px 1fr;
      gap:14px;
      padding:14px;
    }
    @media (max-width: 900px){ .main{grid-template-columns:1fr} }

    /* å·¦ä¾§ï¼šä¹Œè¨å¥‡&å°å…«ï¼ˆåŸåˆ›é£æ ¼å ä½ï¼‰ */
    .sticker{
      width:100%;
      aspect-ratio: 1 / 1;
      border-radius:22px;
      border:1px solid var(--border);
      background: radial-gradient(240px 240px at 28% 20%, #fff, #f2fbff);
      box-shadow: 0 12px 28px rgba(0,0,0,.08);
      position:relative;
      overflow:hidden;
    }
    .st-bubble{
      position:absolute; top:14px; left:14px;
      background:#fff;
      border:1px solid var(--border);
      border-radius:16px;
      padding:10px 12px;
      font-weight:900;
      box-shadow: 0 8px 18px rgba(0,0,0,.07);
      white-space:pre-line;
      max-width:80%;
    }
    .chars{
      position:absolute; inset:0;
      display:flex;
      align-items:flex-end;
      justify-content:space-around;
      padding:26px 18px 16px;
      gap:14px;
    }
    .c{
      width:45%;
      height:58%;
      border-radius:22px;
      border:1px solid var(--border);
      background:#fff;
      display:flex;
      align-items:center;
      justify-content:center;
      position:relative;
    }
    .face{
      width:74%;
      height:74%;
      border-radius:20px;
      border:1px solid var(--border);
      position:relative;
      background: linear-gradient(180deg,#fff, #fafafa);
    }
    .ear{
      position:absolute; width:34%; height:30%;
      border:1px solid var(--border);
      border-radius:14px; top:-10%; background:#fff;
    }
    .ear.l{left:6%} .ear.r{right:6%}
    .eye{position:absolute; top:42%; width:10px; height:14px; background:#222; border-radius:10px;}
    .eye.l{left:28%} .eye.r{right:28%}
    .mouth{
      position:absolute; top:62%; left:50%;
      width:22px; height:10px;
      border:2px solid #222;
      border-top:none; border-left:none; border-right:none;
      transform:translateX(-50%);
      border-radius:0 0 999px 999px;
    }
    .tag{
      position:absolute; bottom:10px; left:50%;
      transform:translateX(-50%);
      font-size:12px; color:var(--muted);
      background:#ffffffd9; border:1px solid var(--border);
      border-radius:999px; padding:6px 10px;
    }
    .shake{animation: shake .28s ease-in-out 1}
    @keyframes shake{0%{transform:translateX(0)}25%{transform:translateX(-6px)}50%{transform:translateX(6px)}75%{transform:translateX(-4px)}100%{transform:translateX(0)}}

    /* å³ä¾§ï¼šæµç¨‹å¯¹è¯ */
    .panel{
      border-radius:18px;
      border:1px solid var(--border);
      background:#ffffffb3;
      padding:14px;
      min-height:380px;
      position:relative;
      overflow:hidden;
    }
    .title{
      margin:0 0 6px;
      font-size:22px;
      font-weight:950;
      letter-spacing:.2px;
    }
    .sub{
      margin:0 0 14px;
      color:var(--muted);
      line-height:1.6;
      font-size:14px;
    }
    .dialog{
      border:1px solid var(--border);
      background:#fff;
      border-radius:16px;
      padding:12px 12px;
      line-height:1.7;
      box-shadow: 0 6px 16px rgba(0,0,0,.06);
      white-space:pre-line;
    }
    .options{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:12px;
    }
    button{
      border:1px solid var(--border);
      background:#fff;
      border-radius:14px;
      padding:12px 14px;
      font-size:14px;
      cursor:pointer;
      box-shadow: 0 6px 16px rgba(0,0,0,.06);
      transition: transform .08s ease, box-shadow .2s ease;
    }
    button:hover{box-shadow:0 10px 24px rgba(0,0,0,.10)}
    button:active{transform:translateY(1px) scale(.99)}
    .primary{
      background: linear-gradient(180deg,#fff,#f1fbff);
      border-color:#00000010;
    }
    .danger{
      border-color:#ff000022;
      background: linear-gradient(180deg,#fff,#fff3f6);
    }

    /* è§’è½å°æŒ‰é’®ï¼šä¸€ç‚¹éƒ½ä¸æƒ³ */
    .tiny-corner{
      position:absolute;
      right:12px;
      bottom:12px;
      font-size:12px;
      padding:8px 10px;
      border-radius:999px;
      opacity:.85;
    }

    /* æ–‡å­—é—ªçƒæç¤º */
    .flash{
      position:absolute;
      inset:auto 0 56px 0;
      text-align:center;
      font-weight:950;
      letter-spacing:.5px;
      color:var(--accent);
      text-shadow: 0 6px 22px rgba(255,90,165,.35);
      animation: pop 0.35s ease-out 1, blink 1.1s ease-in-out infinite;
      pointer-events:none;
      padding:0 12px;
    }
    @keyframes pop{ from{transform:translateY(6px); opacity:0} to{transform:translateY(0); opacity:1} }
    @keyframes blink{ 0%,100%{opacity:.2} 50%{opacity:1} }

    /* éŸ³é¢‘åŒº */
    .audioBox{
      margin-top:12px;
      border:1px dashed var(--border);
      border-radius:14px;
      padding:12px;
      background:#ffffffcc;
      color:var(--muted);
      font-size:13px;
      line-height:1.6;
    }
    audio{width:100%; margin-top:8px;}
    .footer{
      padding:12px 14px;
      border-top:1px solid var(--border);
      background:#ffffffb3;
      color:var(--muted);
      font-size:12px;
      display:flex;
      gap:10px;
      justify-content:space-between;
      flex-wrap:wrap;
    }
    a{color:inherit}
    code{background:#00000008; padding:2px 6px; border-radius:8px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div class="pill">ğŸ’— Ranniå®å®æµç¨‹ç«™</div>
      <div class="pill" id="today"></div>
      <div class="pill">ä¹Œè¨å¥‡ & å°å…«ï¼šæµç¨‹æ§åˆ¶ä¸­</div>
    </div>

    <div class="card">
      <div class="main">
        <div>
          <div class="sticker" id="sticker">
            <div class="st-bubble" id="stBubble">Ranniå®å®ï½èµ·åºŠäº†å—ï¼Ÿ\nï¼ˆå°å…«ä¸¾æ‰‹ï¼šæˆ‘æ¥é—®ï¼ï¼‰</div>
            <div class="chars">
              <div class="c">
                <div class="face">
                  <div class="ear l"></div><div class="ear r"></div>
                  <div class="eye l"></div><div class="eye r"></div>
                  <div class="mouth"></div>
                </div>
                <div class="tag">å°å…«</div>
              </div>

              <div class="c" style="background:#fff7ef">
                <div class="face" style="background:linear-gradient(180deg,#fff7ef,#fff)">
                  <div class="ear l" style="background:#fff7ef"></div>
                  <div class="ear r" style="background:#fff7ef"></div>
                  <div class="eye l"></div><div class="eye r"></div>
                  <div class="mouth"></div>
                </div>
                <div class="tag">ä¹Œè¨å¥‡</div>
              </div>
            </div>
          </div>

          <div class="audioBox" id="devBox">
            <b>é…ç½®åŒºï¼ˆä½ è¦æ”¹çš„åœ°æ–¹ï¼‰</b><br/>
            1) Webhookï¼šæŠŠ <code>NOTIFY_URL</code> æ”¹æˆä½ çš„é€šçŸ¥æ¥å£ï¼ˆä¸æƒ³ç”¨å°±ç•™ç©ºï¼‰ã€‚<br/>
            2) èµ–åºŠéŸ³ä¹ï¼šæŠŠ <code>SWIM_AUDIO_URL</code> æ¢æˆä½ æœ‰æƒé™çš„éŸ³é¢‘ URLï¼ˆå¦åˆ™åªæ˜¾ç¤ºâ€œç‚¹å‡»æ’­æ”¾å ä½â€ï¼‰ã€‚<br/>
          </div>
        </div>

        <div class="panel" id="panel">
          <h1 class="title" id="title">è¿›å…¥æµç¨‹</h1>
          <p class="sub" id="sub">ç‚¹ä¸€ä¸‹æŒ‰é’®æ¨è¿›å‰§æƒ…ã€‚</p>

          <div class="dialog" id="dialog"></div>
          <div class="options" id="options"></div>

          <!-- è§’è½å°æŒ‰é’®å®¹å™¨ -->
          <div id="corner"></div>

          <!-- é—ªçƒæç¤º -->
          <div id="flashHost"></div>
        </div>
      </div>

      <div class="footer">
        <div>æç¤ºï¼šiPhone/å¾®ä¿¡å†…ç½®æµè§ˆå™¨ä¸€èˆ¬ä¸å…è®¸è‡ªåŠ¨æ’­æ”¾ï¼ŒéŸ³ä¹éœ€è¦å¥¹ç‚¹ä¸€æ¬¡æ’­æ”¾ã€‚</div>
        <div>ä½ è¦æ›´åƒåŸä½œçš„è§†è§‰ï¼šä½ æä¾›ä½ æœ‰æˆæƒçš„ç´ æå›¾ï¼Œæˆ‘å†å¸®ä½ æ›¿æ¢æˆè´´å›¾ç‰ˆã€‚</div>
      </div>
    </div>
  </div>

<script>
  /** ==========================
   *  ä½ éœ€è¦æ”¹çš„é…ç½®
   *  ========================== */

  // æ–¹æ¡ˆ1ï¼šWebhookï¼ˆæ¨èï¼‰â€”â€” å¥¹ç‚¹â€œæƒ³/ç‰¹åˆ«æƒ³â€æ—¶ä¼šPOSTé€šçŸ¥åˆ°ä½ 
  // ç•™ç©º "" åˆ™ä¸å‘è¯·æ±‚
  const NOTIFY_URL = ""; // ä¾‹ï¼šhttps://script.google.com/macros/s/XXXX/exec

  // èµ–åºŠåˆ†æ”¯éŸ³é¢‘ï¼ˆä½ æœ‰æƒé™çš„éŸ³é¢‘URLï¼Œæ¯”å¦‚ä½ è‡ªå·±ä¸Šä¼ çš„mp3ï¼‰
  const SWIM_AUDIO_URL = ""; // ä¾‹ï¼šhttps://your-domain.com/swim.mp3

  // â€œè”ç³»ä½ â€çš„å¤‡ç”¨æ–¹æ¡ˆï¼šå¤åˆ¶ç»™ä½ çš„å¾®ä¿¡æ¶ˆæ¯æ¨¡æ¿
  const SOURCE_NAME = "æº";
  const WECHAT_OPEN_SCHEME = "weixin://"; // å°è¯•æ‰“å¼€å¾®ä¿¡ï¼ˆä¸ä¿è¯æ‰€æœ‰ç¯å¢ƒå…è®¸ï¼‰

  /** ==========================
   *  å·¥å…·å‡½æ•°
   *  ========================== */
  const $ = (s)=>document.querySelector(s);
  const panel = $("#panel");
  const sticker = $("#sticker");
  const stBubble = $("#stBubble");
  const titleEl = $("#title");
  const subEl = $("#sub");
  const dialogEl = $("#dialog");
  const optionsEl = $("#options");
  const cornerEl = $("#corner");
  const flashHost = $("#flashHost");

  function todayStr(){
    const d = new Date();
    const y = d.getFullYear();
    const m = String(d.getMonth()+1).padStart(2,"0");
    const day = String(d.getDate()).padStart(2,"0");
    return `${y}-${m}-${day}`;
  }
  $("#today").textContent = `ğŸ“… ${todayStr()}`;

  function hm(){
    const d = new Date();
    return String(d.getHours()).padStart(2,"0")+":"+String(d.getMinutes()).padStart(2,"0");
  }
  function shake(){
    sticker.classList.remove("shake");
    void sticker.offsetWidth;
    sticker.classList.add("shake");
  }
  function setSticker(text){
    stBubble.textContent = text;
    shake();
  }
  function flash(text){
    flashHost.innerHTML = "";
    const d = document.createElement("div");
    d.className = "flash";
    d.textContent = text;
    flashHost.appendChild(d);
    setTimeout(()=>{ flashHost.innerHTML=""; }, 2200);
  }
  function clearUI(){
    optionsEl.innerHTML = "";
    cornerEl.innerHTML = "";
    // ä¸æ¸… flashHostï¼Œè®©å®ƒè‡ªç„¶æ¶ˆå¤±
  }

  async function copyToClipboard(text){
    try{
      await navigator.clipboard.writeText(text);
      return true;
    }catch(e){
      // å…¼å®¹é™çº§
      const ta = document.createElement("textarea");
      ta.value = text;
      document.body.appendChild(ta);
      ta.select();
      try{ document.execCommand("copy"); }catch(_){}
      document.body.removeChild(ta);
      return true;
    }
  }

  async function notifySource(level){
    // level: "æƒ³" | "ç‰¹åˆ«æƒ³"
    const payload = {
      type: "miss_you",
      level,
      time: new Date().toISOString(),
      local_time: hm(),
      from: "Ranni site"
    };

    let webhookOk = false;
    if(NOTIFY_URL){
      try{
        const res = await fetch(NOTIFY_URL, {
          method: "POST",
